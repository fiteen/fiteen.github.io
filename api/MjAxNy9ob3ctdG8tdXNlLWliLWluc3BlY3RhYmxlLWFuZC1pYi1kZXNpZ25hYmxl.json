{"title":"iOS 自动布局进阶之巧用 IBInspectable 和 IB_DESIGNABLE","date":"2017-08-24T02:33:20.000Z","date_formatted":{"ll":"Aug 24, 2017","L":"08/24/2017","MM-DD":"08-24"},"link":"2017/how-to-use-ib-inspectable-and-ib-designable","comments":true,"tags":["自动布局"],"categories":["iOS"],"updated":"2022-09-02T06:38:13.708Z","content":"<p>交互设计和 UI 设计水准很大程度影响着用户对应用的评价，iOS 开发发展至今已逾 10 年，开发者对于界面 UI 编码的习惯逐渐分化成三大流派：</p>\n<span id=\"more\"></span>\n<ul>\n<li>code - 易追踪、可复用、便于版本控制，但不直观</li>\n<li>xib - 简单便捷、直观、一一对应，但易冲突</li>\n<li>storyboard - 逻辑清晰、简单易用、直观高效，虽易冲突、复用性不佳，但仍是未来趋势</li>\n</ul>\n<p>xib 和 storyboard 均采用了 Interface Builder（IB）来生成 GUI，通过面板上简单的拖拽替代繁琐冗余的 code 来构建页面。但我们经常发现，既有的功能并不能完全满足布局的需要，那么，我们可以通过在特定的位置定义可视化属性 <code>IBInspectable</code>、定义宏 <code>IB_DESIGNABLE</code> 来精简代码。</p>\n<p>下文具体介绍一下如何使用。</p>\n<blockquote>\n<p>【场景】设置按钮：圆角<code>cornerRadius</code>：8pt、边框颜色<code>borderWidth</code>：1pt、边框宽度<code>borderColor</code>：系统蓝色</p>\n</blockquote>\n<h2 id=\"巧用-ibinspectable\"><strong>巧用 IBInspectable</strong><a title=\"#巧用-ibinspectable\" href=\"#巧用-ibinspectable\"></a></h2>\n<p><code>【IBInspectable】</code> 这一属性提供了访问功能的新方式：用户自定义的运行时属性，让支持 KVC 的属性能够在身份检查器（Identity Inspector）的 User Defined Runtime Attributes 中配置。</p>\n<p>它支持修饰的属性类型有：</p>\n<p><code>BOOL</code>、<code>NSNumber</code>、<code>CGPoint</code>、<code>CGSize</code>、<code>CGRect</code>、<code>UIColor</code>、<code>NSString</code>、<code>NSLocalizedString</code>、<code>NSRange</code>、<code>UIImage</code>、<code>NSNull</code>。</p>\n<p>如果想让特定类型的控件设置某个属性，可以为对应的 UIKit 添加分类，为定义该属性时加上 <code>IBInspectable</code>，示例：</p>\n<figure class=\"highlight objc\"><figcaption><span>UIButton+HTAdditions.h</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"string\">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">UIButton</span> (<span class=\"title\">HTAdditions</span>)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">nonatomic</span>) IBInspectable <span class=\"built_in\">CGFloat</span> kCornerRadius;</span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">nonatomic</span>) IBInspectable <span class=\"built_in\">CGFloat</span> kBorderWidth;</span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">nonatomic</span>,<span class=\"keyword\">copy</span>) IBInspectable <span class=\"built_in\">UIColor</span> *gBorderColor;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n<p>这时 Xcode 的 Attributes Inspector 栏中就会出现三个新的可编辑属性。</p>\n<p><img src=\"/2017/how-to-use-ib-inspectable-and-ib-designable/visual-properties-1.png\" alt=\"Attributes Inspector 显示的可视化属性\" class=\"φcx\"></p>\n<p>Identity Inspector 下的 User Defined Runtime Attributes 也会出现相应的 key path 和 value 值。</p>\n<p><img src=\"/2017/how-to-use-ib-inspectable-and-ib-designable/visual-properties-2.png\" alt=\"User Defined Runtime Attributes 显示的可视化属性\" class=\"φcx\"></p>\n<p>设置好后 run 一下工程就能看到场景中要求的效果，但通常开发者不需要所有的按钮都设置圆角、边框，更多的是采用自定义视图的形式统一处理相似风格的 control。为了更高效地开发，接下来介绍宏定义 <code>IB_DESIGNABLE</code>。</p>\n<h2 id=\"巧用-ib_designable\"><strong>巧用 IB_DESIGNABLE</strong><a title=\"#巧用-ib_designable\" href=\"#巧用-ib_designable\"></a></h2>\n<p><code>【IB_DESIGNABLE】</code> 在类名前加上此宏定义，初始化、布置和绘制方法将被用来在画布上渲染该类的自定义视图。</p>\n<p>操作步骤：</p>\n<p>1、storyboard 中拖拽一个 UIButton；</p>\n<p>2、创建父类是 UIButton 的 HTCustomButton 类文件，并在 .h 的 <code>interface</code> 前定义 <code>IB_DESIGNABLE</code>；</p>\n<p>3、给步骤 1 按钮的 Custom Class 关联上 HTCustomButton。</p>\n<p>这时我们就可以直接在 User Defined Runtime Attributes 中加入想要的属性，例如圆角、边框宽度等。边框颜色由于 UIColor 类型的特殊性，需要重新定义。</p>\n<figure class=\"highlight objc\"><figcaption><span>HTCustomButton.h</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"string\">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">IB_DESIGNABLE</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">HTCustomButton</span> : <span class=\"title\">UIButton</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/** 设置边框颜色可视化 */</span></span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">nonatomic</span>, <span class=\"keyword\">strong</span>)IBInspectable <span class=\"built_in\">UIColor</span> *customBorderColor;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight objc\"><figcaption><span>HTCustomButton.m</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"string\">&quot;HTCustomButton.h&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">HTCustomButton</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 设置边框颜色</span></span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"type\">void</span>)setCustomBorderColor:(<span class=\"built_in\">UIColor</span> *)customBorderColor &#123;</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.layer.borderColor = customBorderColor.CGColor;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n<p>设置好后就可以直接添加或修改相应的属性动态刷新控件，如下图：</p>\n<p><img src=\"/2017/how-to-use-ib-inspectable-and-ib-designable/custom-view-dynamically-refreshes-the-rendering-with-ib-designable.gif\" alt=\"自定义视图通过 IB_DESIGNABLE 动态刷新效果图\" class=\"φcx\"></p>\n<h2 id=\"纯代码开发流派如何借助-ib_designable动态查看布局效果\"><strong>纯代码开发流派如何借助 <code>IB_DESIGNABLE</code>动态查看布局效果</strong><a title=\"#纯代码开发流派如何借助-ib_designable动态查看布局效果\" href=\"#纯代码开发流派如何借助-ib_designable动态查看布局效果\"></a></h2>\n<p>对于很多被强制勒令用纯代码 coding 的开发者来说，下面介绍的干货绝对会大大提升开发效率。</p>\n<p>举个例子：创建基于 UIView 的 HTMasonryView，以及同名的 .xib 文件，并在 Custom Class 中关联好。接下来在 HTMasonryView.m 中创建并布局 masonryButton，注意添加 <code>IB_DESIGNABLE</code>，代码如下：</p>\n<figure class=\"highlight objc\"><figcaption><span>HTMasonryView.m</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"string\">&quot;HTMasonryView.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"string\">&lt;Masonry.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"string\">&quot;UIButton+HTAdditions.h&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">IB_DESIGNABLE</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">HTMasonryView</span> ()</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">nonatomic</span>, <span class=\"keyword\">strong</span>) <span class=\"built_in\">UIButton</span> *masonryButton;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">HTMasonryView</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">instancetype</span>)initWithFrame:(<span class=\"built_in\">CGRect</span>)frame &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">self</span> = [<span class=\"variable language_\">super</span> initWithFrame:frame]) &#123;</span><br><span class=\"line\">        [<span class=\"keyword\">self</span> setupView];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">self</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">-(<span class=\"keyword\">instancetype</span>)initWithCoder:(<span class=\"built_in\">NSCoder</span> *)aDecoder &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">self</span> = [<span class=\"variable language_\">super</span> initWithCoder:aDecoder]) &#123;</span><br><span class=\"line\">        [<span class=\"keyword\">self</span> setupView];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">self</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"type\">void</span>)setupView &#123;</span><br><span class=\"line\">    _masonryButton = (&#123;</span><br><span class=\"line\">        <span class=\"built_in\">UIButton</span> *btn = [<span class=\"built_in\">UIButton</span> buttonWithType:<span class=\"built_in\">UIButtonTypeSystem</span>];</span><br><span class=\"line\">        btn.kCornerRadius = <span class=\"number\">8.0</span>f;</span><br><span class=\"line\">        btn.kBorderWidth = <span class=\"number\">1.0</span>f;</span><br><span class=\"line\">        btn.gBorderColor = btn.ht_normalTitleColor;</span><br><span class=\"line\">        btn.ht_normalTitle = <span class=\"string\">@&quot;code创建-Masonry布局的按钮&quot;</span>;</span><br><span class=\"line\">        btn.titleLabel.font = [<span class=\"built_in\">UIFont</span> systemFontOfSize:<span class=\"number\">14.0</span>f];</span><br><span class=\"line\">        [<span class=\"keyword\">self</span> addSubview:btn];</span><br><span class=\"line\">        btn;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    [<span class=\"keyword\">self</span> layout];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"type\">void</span>)layout &#123;</span><br><span class=\"line\">    [_masonryButton mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class=\"line\">        make.left.mas_equalTo(<span class=\"number\">30</span>);</span><br><span class=\"line\">        make.right.mas_equalTo(<span class=\"number\">-30</span>);</span><br><span class=\"line\">        make.top.bottom.mas_equalTo(<span class=\"keyword\">self</span>);</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n<p>点开 HTMasonryView.xib 查看会发现已经渲染出了 Masonry 的布局效果。</p>\n<p><img src=\"/2017/how-to-use-ib-inspectable-and-ib-designable/dynamically-refresh-the-rendering-with-the-masonry-layout.gif\" alt=\"通过 Masonry 布局动态刷新效果图\" class=\"φcx\"></p>\n<p>ps：如果渲染失败，查看 Editor -&gt; Automatically Refresh Views 是否勾选，尝试重启 Xcode。</p>\n<p>开启成功的特点就是 Show the Identity inspector-&gt;Custom Class-&gt;Designables:Up to date(更新完毕)/Updating(更新中)，如果显示 Build failed 建议检查布局代码。</p>\n<hr>\n<p>欢迎评论，最后-&gt; <a href=\"https://github.com/fiteen/HTIBInspectableDemo\" target=\"_blank\">Demo 传送门</a></p>\n","prev":{"title":"iOS 逆向分析之 class-dump","link":"2017/class-dump"},"next":{"title":"iOS 购物车设计模式浅析及代码实现","link":"2017/analysis-of-ios-shopping-cart-design-pattern-and-code-implementation"},"plink":"https://blog.fiteen.top/2017/how-to-use-ib-inspectable-and-ib-designable/","toc":[{"id":"巧用-ibinspectable","title":"巧用 IBInspectable","index":"1"},{"id":"巧用-ib_designable","title":"巧用 IB_DESIGNABLE","index":"2"},{"id":"纯代码开发流派如何借助-ib_designable动态查看布局效果","title":"纯代码开发流派如何借助 IB_DESIGNABLE动态查看布局效果","index":"3"}],"reward":true,"copyright":{"author":"FiTeen","link":"<a href=\"https://blog.fiteen.top/2017/how-to-use-ib-inspectable-and-ib-designable/\" title=\"iOS 自动布局进阶之巧用 IBInspectable 和 IB_DESIGNABLE\">https://blog.fiteen.top/2017/how-to-use-ib-inspectable-and-ib-designable/</a>","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow noopener\" target=\"_blank\">CC BY-NC-ND 4.0</a>)"}}