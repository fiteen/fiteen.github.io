{"title":"你应该了解的 IDFA","date":"2017-02-07T06:26:10.000Z","date_formatted":{"ll":"Feb 7, 2017","L":"02/07/2017","MM-DD":"02-07"},"link":"2017/what-is-idfa","comments":true,"tags":["IDFA"],"categories":["iOS"],"updated":"2022-09-02T06:38:13.804Z","content":"<h2 id=\"何为-idfa\">何为 IDFA<a title=\"#何为-idfa\" href=\"#何为-idfa\"></a></h2>\n<p><a href=\"https://developer.apple.com/documentation/adsupport/asidentifiermanager\" target=\"_blank\">IDFA</a>，苹果 iOS6 开始新增的广告标识符， 全称 Identifier For Advertising，是每台 iOS 设备的唯一 ID，是投放定向广告的唯一方法。</p>\n<span id=\"more\"></span>\n<p>在苹果禁用 UDID 后，IDFA 成为了标识 iPhone 用户的标准。通常用于广告追踪，在同一设备的不同 App 间进行信息共享。</p>\n<p>IDFA 是一段 16 进制的 32 位字符串，例如<code>D7DFA3F1-0E1C-49CD-AFBC-75601390FEA2</code>。可以通过以下代码获取：</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"string\">&lt;AdSupport/ASIdentifierManager.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">NSString</span> *idfa = [[[ASIdentifierManager sharedManager] advertisingIdentifier] UUIDString];</span><br></pre></td></tr></table></figure>\n<p>这个标识符虽然是唯一的，但并不是固定不变的，用户可以通过以下两种方式进行重置：</p>\n<ul>\n<li>设置→隐私→广告→还原广告标识符</li>\n<li>设置→通用→还原→还原所有设置/还原位置与信息</li>\n</ul>\n<p>iOS10 之后，还新增了“<strong>限制广告追踪</strong>” 的设置，所以在获取 IDFA 之前，最好优先判断一下 <code>[[ASIdentifierManager sharedManager] isAdvertisingTrackingEnabled]</code> 返回的 BOOL 值，假如返回的是 YES，则能获取正确的 IDFA，否则获取到的字符串就会变成 <code>00000000-0000-0000-0000-000000000000</code>。</p>\n<p>因此，IDFA 并不能成为精确标识用户唯一性的符号。如果要确保唯一且固定，建议采用 UUID+Keychain 的方式，或者借助 iOS 系统可以获取的参数自定义一套算法去生成标志符。</p>\n<h2 id=\"检查是否使用-idfa\">检查是否使用 IDFA<a title=\"#检查是否使用-idfa\" href=\"#检查是否使用-idfa\"></a></h2>\n<p>当 App 提交应用市场审核的时候，苹果会询问“<em>此 App 是否使用广告标识符号（IDFA）</em>”。这里除了本地代码以外，还需要鉴别导入的任何第三方库中，是否使用了 IDFA。检查的方法很简单：</p>\n<ol>\n<li>打开终端 cd 到要检查的文件根目录</li>\n<li>执行语句 <code>grep -r advertisingIdentifier . </code></li>\n</ol>\n<p>以含 IDFA 的友盟 SDK 为例，会出现 matches 的记录。</p>\n<p><img src=\"/2017/what-is-idfa/grep-command.png\" alt=\"检查命令\" class=\"φcx\"></p>\n<h2 id=\"审核时关于-idfa-选项的选择\">审核时关于 IDFA 选项的选择<a title=\"#审核时关于-idfa-选项的选择\" href=\"#审核时关于-idfa-选项的选择\"></a></h2>\n<p>那么如果选择了 “是”，就会提示你选择勾选 4 个选项框：</p>\n<ol>\n<li>\n<p><strong>在 App 内投放广告</strong></p>\n<p>服务应用中的广告。如果你的应用中集成了广告的时候，你需要勾选这一项。</p>\n</li>\n<li>\n<p><strong>标明此 App 安装来自先前投放的特定广告</strong></p>\n<p>跟踪广告带来的安装。如果你使用了第三方的工具来跟踪广告带来的激活以及一些其他事件，但是应用里并没有展示广告你需要勾选这一项。</p>\n</li>\n<li>\n<p><strong>标明此 App 中发生的操作来自先前投放的广告</strong></p>\n<p>跟踪广告带来的用户的后续行为。如果你使用了第三方的工具来跟踪广告带来的激活以及一些其他事件，你需要勾选这一项。</p>\n</li>\n<li>\n<p><strong>iOS 中的“限制广告跟踪”设置</strong></p>\n<p>对您的应用使用 IDFA 的目的做下确认，只要您获取了 IDFA，那么这一项都是需要勾选的。</p>\n</li>\n</ol>\n<blockquote>\n<p><strong>总结</strong></p>\n<ol>\n<li>如果你的应用里只是集成了广告，不追踪广告带来的激活行为，那么选择 1 和 4；</li>\n<li>如果你的应用没有广告，而又获取了 IDFA，选择 2 和 4；</li>\n<li>如果你的应用没有广告，但是需要追踪广告带来的激活行为，那么选择 2、3 和 4；</li>\n<li>如果你的应用里集成了广告，而且使用了 SDK 等用来追踪广告带来的激活行为，需要选择 1、2、3 和 4 。</li>\n</ol>\n</blockquote>\n<p>如果还是无法确定如何选择，可以参考第三方的官方文档，基本上都会在开发文档中体现。</p>\n","prev":{"title":"释放你的内存——Xcode 缓存清理","link":"2017/xcode-clean"},"next":{"title":"一次搞懂时间复杂度和空间复杂度","link":"2017/asymptotic-time-complexity-and-space-complexity"},"plink":"https://blog.fiteen.top/2017/what-is-idfa/","toc":[{"id":"何为-idfa","title":"何为 IDFA","index":"1"},{"id":"检查是否使用-idfa","title":"检查是否使用 IDFA","index":"2"},{"id":"审核时关于-idfa-选项的选择","title":"审核时关于 IDFA 选项的选择","index":"3"}],"reward":true,"copyright":{"author":"FiTeen","link":"<a href=\"https://blog.fiteen.top/2017/what-is-idfa/\" title=\"你应该了解的 IDFA\">https://blog.fiteen.top/2017/what-is-idfa/</a>","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow noopener\" target=\"_blank\">CC BY-NC-ND 4.0</a>)"}}